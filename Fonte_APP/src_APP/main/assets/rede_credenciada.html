<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Language" content="pt-br">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Odontoprev</title>

	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<link href="css/odontoprev.css" rel="stylesheet">

	<script type="text/javascript">

		window.onload = function(){
			especialidades();
		}

    </script>
</head>

<body>
<!-- Menu -->
<div class="closeNav hide" onclick="closeNav()"></div>
<div id="mySidenav" class="sidenav">
	<div class="row">
		<div class="col-md-12 userLog">
			<div class="col-md-12">
				<div class="perfilMenu">
					<img src="img/icone_325x325.png" class="imgPerfil" alt="">
					<div>
						<label class="labelOdontMenu">Rosário Lopes</label>
					</div>
					<div>
						<label class="subLabelOdontMenu">Corretora XPTO</label>
					</div>
				</div>
			</div>
		</div>
	</div>
	<a href="logado.html" class="linkMenu"><img src="img/menu-home.png" align="center">TELA INICIAL</a>
    <a href="venda_index_pf.html" class="linkMenu"><img src="img/menu-vender-pf.png" align="center">VENDER PESSOA FÍSICA</a>
    <a href="venda_index_pme.html" class="linkMenu"><img src="img/menu-vender-pme.png" align="center">VENDER PME</a>
    <a href="rede_credenciada.html" class="linkMenu colorActive"><img src="img/menu-rede-credenciada.png" align="center">BUSCAR REDE CREDENCIADA</a>
    <a href="lista_proposta.html" class="linkMenu"><img src="img/menu-listas.png" align="center">LISTA DE PROPOSTA</a>
    <!-- <a href="#" class="linkMenu"><img src="img/menu-listas.png" align="center">INFORMAÇÕES DOS PLANOS</a> -->
    <a href="meus_dados.html" class="linkMenu"><img src="img/menu-meus-dados.png" align="center">MEUS DADOS</a>
    <a href="fale_conosco.html" class="linkMenu"><img src="img/menu-contato.png" align="center">FALE CONOSCO</a>
    <a href="index.html" class="linkMenu"><img src="img/sair.png" class="sair" width="20px" height="20px" align="center">SAIR</a>
</div>
<!-- End Menu -->
<!-- Bloco 1 -->
<div class="container-fluid">
	<div class="row">
		<div class="col-md-12 boxHeader">
			<div class="col-md-12 text-left imgLogoODPVHeader">
				<img src="img/logoODPV-header.png" class="" alt="Logo ODPV Header">
			</div>
			<span class="btnMenu" onclick="openNav()">&#9776;</span>
		</div>
	</div>
    <div class="row">
        <div class="col-md-12 odontBoxCenter">
			<div class="text-center">
				<div>
					<h1 class="titleOdont text-center">
						REDE CREDENCIADA
					</h1>
					<h2 class="subTitleOdont text-center">
						Encontre um dentista para o seu cliente
					</h2>
				</div>
			</div>
        
            <div class="boxLabInput">
                <div>
                    <label class="label-cep labelOdontBlur">CEP</label>
                </div>
                <div>
                    <input type="text" class=" cep inputLabelBlur" id="cep">
                </div>
                <div>
                    <label class="label-bairro labelOdontBlur">BAIRRO</label>
                </div>
                <div>
                    <input type="text" class="bairro inputLabelBlur" id="bairro">
                </div>
                <div>
                    <label class="label-cidade labelOdontBlur">CIDADE</label>
                </div>
                <div>
                    <input type="text" class="cidade inputLabelBlur" id="cidade">
                </div>
                <div class="form-group">
                    <label for="" class="label-especialidade labelOdontBlur">Especialidades</label>
                    <select class="form-control especialidade selectListBlur" id="especs">

                    </select>
                </div>
            </div>
            
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-12 btnPadBtm">
            <!--<a class="btn btn-lg btn-block btnOdont" id="" data-toggle="modal" data-target="#myModal" role="button">BUSCAR</a>-->
            <button class="btn btn-lg btn-block btnOdont" id="btnTeste">BUSCAR</button>
        </div>
    </div>

	<div id="map" class="nopadding">
		<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJVbswYP8yLVKCQGtTN3Xsifugqm8BBkQ&callback=mapa">
		</script>
	</div>
		<script>

        	function initMap(redeCredenciada)
        	{
            	var latlng = { lat: -23.5432147, lng: -46.7356894 };
            	mapa(redeCredenciada);
        	}

        </script>

</div>
<!-- End Bloco 1 -->
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog">
	<div class="modal-dialog modalConteiner">
		<div class="modal-content">
			<div class="modal-header-OdontMed">
				<div class"row">
				<div class="">
					<span class="labelBoldModal">Dra. Juliana Matias Pereira</span>
				</div>
				<div>
					<span class="labelLightModal">CRO 34598</span>
					<label class="labelLightModal">Estabelecimento:</label>
					<span class="labelLightModal">Pessoa Física</span>
				</div>
			</div>
		</div>
		<div class="col-md-12 labelBoldModalPlano"><span>Atende ao plano MASTER</span></div>
		<div class="modal-body-OdontMed">
			<div class="row">
				<label class="labelBoldTitleModal">Especialidades</label>

				<div class="text-center">
					<label><img src="img/Protese.png" class="" alt=""><p>Prótese</p></label>
					<label><img src="img/Ortodontia.png" class="" alt=""><p>Ortodontia</p></label>
					<label><img src="img/Consulta.png" class="" alt=""><p>Consulta</p></label>
					<label><img src="img/Cirurgia.png" class="" alt=""><p>Cirurgia</p></label>
				</div>
			</div>
		</div>
		<div class="modal-footer-OdontMed">
			<div>
				<label class="labelBoldPink">Endereço</label>
				<p class="labelBold">Rua Caramuru, 417 Cj 55 - Saúde</p>
				<p class="labelBold">CEP 04138-001 São Paulo - SP</p>
			</div>
			<div>
				<label class="labelBoldPink">Contato</label>
				<p class="labelBold">(11) 1234-5678</p>
				<p class="labelBold">contato@doutorajuliana.com.br</p>
				<p class="labelBold">www.doutorajuliana.com.br</p>
			</div>
		</div>
	</div>
</div>
<!-- End Modal -->
<script src="../../../../src/main/assets/js/jquery.min.js"></script>
<script src="../../../../src/main/assets/js/bootstrap.min.js"></script>
<script src="js/scripts.js"></script>
<script src="js/odontoprev.js"></script>
<script src="../../../../src/main/assets/js/jquery.3.2.1.js"></script>
<script src="../../../../src/main/assets/js/jquery.mask.min.js"></script>
<script src="js/odonto-Valida.js"></script>
<script src="C:\Users\Treinamento6\Downloads\Jquery.js"></script>



<script type="text/javascript">

		function especialidades()
		{
			callToken(function (dataToken)
			{
            	callEspecialidades(function (dataEspecialidades)
                {
                    console.log(dataEspecialidades);

                    var sel = document.getElementById('especs');

                    for (var i = 0; i < dataEspecialidades.length; i++) {

                        var opt = document.createElement('option');
                        console.log(dataEspecialidades[i].descricao);
                        opt.setAttribute('value', dataEspecialidades[i].codigo);
                        console.log(dataEspecialidades[i].codigo);
                        opt.appendChild(document.createTextNode(dataEspecialidades[i].descricao));
                        sel.appendChild(opt);
                    }

                    var especialidade = 1;
					document.getElementById('especs').value = especialidade;

            	},dataToken.access_token);
            });
		}

        function mapa(abc) {
            var latlng = { lat: -23.5432147, lng: -46.7356894 };
            //initMap(latlng);

            if (abc == null) {
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 4,
                    center: latlng,
                    disableDefaultUI: true
                });
            }
            else if (abc != null) {
                     map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 11,
                        center: { lat: parseFloat(abc.dentistas[0].endereco.cidade.latitude), lng: parseFloat(abc.dentistas[0].endereco.cidade.longitude) },
                        disableDefaultUI: true
                    });

                for (var i = 0; i < abc.dentistas.length; i++) {
                    var latlng2 = new google.maps.LatLng((abc.dentistas[i].endereco.cidade.latitude), (abc.dentistas[i].endereco.cidade.longitude));

                    var marker = new google.maps.Marker({
                        position: latlng2,
                        map: map,
                        center: latlng2
                    });
                }
            }
        }

        var t;

        function callToken(callback) {

            $.ajax({
                async: true,
                url: "https://api.odontoprev.com.br:8243/token/",
                method: "POST",
                headers: {
                    "Authorization": "Basic Y3hHZXBoTzFkcERDd3U0VHlfRExWTWxXQ0R3YTp0WlJtSUN1eUJWajJZRVczRjdaNXdWM2E0YVlh",
                    "Cache-Control": "no-cache",
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                data: {
                    "grant_type": "client_credentials"
                },
                success: function (resp) {
                    callback(resp)
                },
            });
        }

        function callCep(callback, token, cep) {

            $.ajax({
                async: true,
                url: "https://api.odontoprev.com.br:8243/cep/1.1/por/cep/" + cep,
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + token,
                    "Cache-Control": "no-cache",
                    "Content-Type": "application/json"
                },
                success: function (resp) {
                    callback(resp)
                },
            });
        }

        function callEspecialidades(callback, token) {

            $.ajax({
                async: true,
                url: "https://api.odontoprev.com.br:8243/redecredenciada/1.0/especialidades",
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + token,
                    "Cache-Control": "no-cache",
                    "Content-Type": "application/json"
                },
                success: function (resp) {
                    callback(resp)
                },
            });
        }

        function callCidade(callback, token, uf, codigoCidade) {

            $.ajax({
                async: true,
                url: "https://api.odontoprev.com.br:8243/cep/1.1/cidades/uf?uf=" + uf + "&codigoCidade=" + codigoCidade,
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + token,
                    "Cache-Control": "no-cache",
                    "Content-Type": "application/json"
                },
                success: function (resp) {

                    callback(resp)
                },
            });
        }

        function callBairro(callback, token, uf, codigoCidade, codigoBeneficiario) {


            $.ajax({
                async: true,
                url: "https://api.odontoprev.com.br:8243/cep/1.1/bairros?uf="+ uf +"&codigoCidade=" + codigoCidade +"&codigoBeneficiario="+ codigoBeneficiario,
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token,
                    "Cache-Control": "no-cache",
                    "Postman-Token": "c7575dd9-1908-dcf4-12eb-9091693dd541"

                },
                success: function (resp) {

                    callback(resp)

                },
            });
        }

        function callRedeCredenciada(callback, token, CodBeneficiario, uf, codigoEspecialidade, codigoMicroregiao, privian, codigoMarca, codigoBairro) {


            $.ajax({
                async: true,
                url: "https://api.odontoprev.com.br:8243/dcms/redecredenciada/1.0/dentistas?codigoBeneficiario=" + CodBeneficiario
                    + "&siglaUf=" + uf + "&codigoEspecialidade=" + codigoEspecialidade + "&codigoRegiao=" + codigoMicroregiao + "&privian=" + privian + "&codigoMarca=" +
                    codigoMarca + "&codigoBairro=" + codigoBairro,
                //url: "https://api.odontoprev.com.br:8243/cep/1.1/bairros?uf=" + uf + "&codigoCidade=" + codigoCidade + "&codigoBeneficiario=" + codigoBeneficiario,
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token,
                    "Cache-Control": "no-cache"
                },
                success: function (resp) {

                    callback(resp)

                },
            });
        }


        function removerAcentos(newStringComAcento) {
            var string = newStringComAcento;
            var mapaAcentosHex = {
                a: /[\xE0-\xE6]/g,
                e: /[\xE8-\xEB]/g,
                i: /[\xEC-\xEF]/g,
                o: /[\xF2-\xF6]/g,
                u: /[\xF9-\xFC]/g,
                c: /\xE7/g,
                n: /\xF1/g
            };

            for (var letra in mapaAcentosHex) {
                var expressaoRegular = mapaAcentosHex[letra];
                string = string.replace(expressaoRegular, letra);
            }

            return string;
        }

        function callTokenBack()
        {

            ob.logString("Foi");
            callToken(function (dataToken)
            {
                ob.logString("Foi dnv");
            });
        }


         $(document).ready(function () {
            var t1;

            $("#btnTeste").click(function (e) {

                var cep = $("#cep").val().replace(/\D/g, '');

                callToken(function (dataToken) {
                    t1 = dataToken;

                    callCep(function (dataCep) {
                        var teste = removerAcentos(dataCep[0].cidade);
                        teste = teste.toUpperCase();


                        callCidade(function (dataCidade) {
                            var result = $.grep(dataCidade, function (e) { return e.nome == removerAcentos(dataCep[0].cidade).toUpperCase(); });

                            var CodBeneficiario = "375796040";


                            callBairro(function (dataBairro) {


                                var codigoEspecialidade = $('#especs').val();
                                var privian = "FALSE";
                                var codigoMarca = "1";

                                //var bairro = dataCep[0].bairro.toUpperCase();

                                var codigoBairro = $.grep(dataBairro, function (e) { return e.nome == dataCep[0].bairro.toUpperCase() });

                                console.log(codigoBairro);
                                console.log(result[0].codigoMicroregiao);


                                if (codigoBairro.length == 0) {
                                    callRedeCredenciada(function (dataRedeCredenciada) {
                                        console.log(dataRedeCredenciada);
                                        initMap(dataRedeCredenciada);

                                    }, dataToken.access_token, CodBeneficiario, dataCep[0].estado, codigoEspecialidade, result[0].codigoMicroregiao, privian, codigoMarca, "0");

                                }
                                else if (codigoBairro != null) {
                                    callRedeCredenciada(function (dataRedeCredenciada) {
                                        initMap(dataRedeCredenciada);
                                    }, dataToken.access_token, CodBeneficiario, dataCep[0].estado, codigoEspecialidade, result[0].codigoMicroregiao, privian, codigoMarca, codigoBairro[0].codigo);
                                }

                            }, dataToken.access_token, dataCep[0].estado, result[0].codigoCidade, CodBeneficiario);

                        }, dataToken.access_token, dataCep[0].estado, dataCep[0].idCidade);

                    }, dataToken.access_token, cep);

                });
            });
        });


        $(document).ready(function() {

            function limpa_formulário_cep() {
                // Limpa valores do formulário de cep.
                $("#bairro").val("");
                $("#cidade").val("");
            }

            var typingTimer; //timer identifier
            var doneTypingInterval = 500; //time in ms, 5 second for example

            //on keyup, start the countdown
        $('#cepRedeCredenciada').keyup(function() {
            clearTimeout(typingTimer);
            if ($('#cepRedeCredenciada').val) {
            typingTimer = setTimeout(doneTyping, doneTypingInterval);
            }
        });

        function doneTyping() {
            validar();
        }

        function validar()
        {
            //Nova variável "cep" somente com dígitos.
            var cep = $('#cepRedeCredencida').val().replace(/\D/g, '');

            //Verifica se campo cep possui valor informado.
            if (cep != "" && cep.length == 8) {

            //Expressão regular para validar o CEP.
            var validacep = /^[0-9]{8}$/;

            //Valida o formato do CEP.
            if(validacep.test(cep)) {

            //Preenche os campos com "..." enquanto consulta webservice.
                $("#bairro").val("");
                $("#cidade").val("");

			$("#cepRedeCredenciada").val("00000-000");
            callToken(function (dataToken)
			{
				callCep(function (dataCep) {
						$("#cepRedeCredenciada").val("00000-000");
				        $("#bairroRedeCredenciada").val(dataCep[0].bairro);
                        $("#cidadeRedeCredenciada").val(dataCep[0].cidade);

				}, dataToken.access_token, cep);
			});

            //    //Consulta o webservice viacep.com.br/
            //    $.getJSON("https://viacep.com.br/ws/"+ cep +"/json/?callback=?", function(dados)
            //    {
            //        if (!("erro" in dados)) {
            //        //Atualiza os campos com os valores da consulta.
            //            $("#rua").val(dados.logradouro);
            //            $("#bairro").val(dados.bairro);
            //            $("#cidade").val(dados.localidade);
            //            $("#uf").val(dados.uf);
            //        } //end if.
            //        else {
            //            //CEP pesquisado não foi encontrado.
            //            limpa_formulário_cep();
            //            alert("CEP não encontrado.");
            //        }
            //    });




            } //end if.
            else {
                //cep é inválido.
                limpa_formulário_cep();
                alert("Formato de CEP inválido.");
                }
            } //end if.
                else {
                    //cep sem valor, limpa formulário.
                    limpa_formulário_cep();
                }
            }

            //Quando o campo cep perde o foco.

        });

        </script>




</body>
</html>